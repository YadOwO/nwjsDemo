<!DOCTYPE html>
<meta charset="UTF-8">
<html>
<head>
  <title>NW.js Demo</title>
  <style>
    body {
      background-color: #000;
    }
    .box {
      float: right;
      width: 50px;
      height: 50px;
      background-color: pink;
      transition: width 1s;
    }
    .box:hover {
      width: 200px;
    }
  </style>
</head>
<body>
  <div class="box" id="draggable">doctor</div>
  <script>
    // 使用node.js获取系统信息
    // var os = require('os');
    // document.write('您当前系统为 ', os.platform());

    //  获取窗口对象
    let win = nw.Window.get();
    // 获取屏幕尺寸
    let screen = nw.Screen.screens[0];
    let screenWidth = screen.bounds.width;
    let screenHeight = screen.bounds.height;

    // 计算窗口的目标位置
    let windowWidth = 70;  // 更改为你的窗口宽度
    let windowHeight = 70;  // 更改为你的窗口高度
    let targetX = screenWidth - windowWidth;
    let targetY = screenHeight - windowHeight - 300;

    // 窗口初始位置
    nw.Window.get().moveTo(targetX, targetY);


    // // -----拖拽------
    let dragging = false;
    let startX = 0, startY = 0;

    document.getElementById('draggable').addEventListener('mousedown', (event) => {
      dragging = true;
      startX = event.screenX - win.x;
      startY = event.screenY - win.y;
    });

    document.addEventListener('mousemove', (event) => {
      if (!dragging) return;
      win.moveTo(event.screenX - startX, event.screenY - startY);
    });

    document.addEventListener('mouseup', () => {
      dragging = false;
    });

    // -----鼠标经过时展开-----
    // 获取 div 元素和窗口的初始尺寸
    let box = document.getElementById('draggable');
    let initialBoxWidth = box.offsetWidth;
    let initialWindowWidth = windowWidth;
    let expandedBoxWidth = 200;  // 根据你的 CSS 规则设置
    // 使用变量记录是否正在变化
    let isTransitioning = false;

    // 当鼠标进入 div 时，扩大窗口并向左移动
    box.addEventListener('mouseover', function(e) {
      // 如果已经在变化，直接返回
      if (isTransitioning) return;

      isTransitioning = true;

      windowWidth = initialWindowWidth + (expandedBoxWidth - initialBoxWidth);
      targetX = screenWidth - windowWidth;
      win.resizeTo(windowWidth, windowHeight);
      win.moveTo(targetX, targetY);

      // 变化完成后，设置 isTransitioning 为 false
      isTransitioning = false;

      console.log('jinruYado')
    });

    // 当鼠标离开 div 时，恢复窗口的大小和位置

    box.addEventListener('mouseleave', function(e) {
      console.log('leaveYado')
    })

    // box.addEventListener('transitionend', function(e) {
    //   if (!isTransitioning) return;
      
    //   windowWidth = initialWindowWidth;
    //   targetX = screenWidth - windowWidth;
    //   win.resizeTo(windowWidth, windowHeight);
    //   win.moveTo(targetX, targetY);

    //   // 变化完成后，设置 isTransitioning 为 false
    //   isTransitioning = false;

    //   console.log('likaiYado');
    // });

  </script>
  </body>
</html>