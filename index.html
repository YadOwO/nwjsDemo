<!DOCTYPE html>
<meta charset="UTF-8">
<html>
<head>
  <title>NW.js Demo</title>
  <style>
    /* body {
      background-color: #000;
      overflow: hidden;
    } */
    .box {
      position: absolute;
      right: 0;
      width: 50px;
      height: 50px;
      background-color: pink;
      transition: width 1s;
    }
    .box:hover {
      width: 200px;
    }
  </style>
</head>
<body>
  <div class="box" id="draggable">doctor</div>
  <script>
    //  获取窗口对象
    let win = nw.Window.get();
    // 获取屏幕尺寸
    let screen = nw.Screen.screens[0];
    let screenWidth = screen.bounds.width;
    let screenHeight = screen.bounds.height;

    // 计算窗口的目标位置
    let windowWidth = 70;  // 更改为你的窗口宽度
    let windowHeight = 70;  // 更改为你的窗口高度
    let targetX = screenWidth - windowWidth;
    let targetY = screenHeight - windowHeight - 300;

    // 窗口初始位置
    win.moveTo(targetX, targetY);

    // 获取 div 元素
    let box = document.getElementById('draggable');

    // 动态调整窗口大小以适应 div 的宽度
    function adjustWindow() {
      let boxWidth = box.offsetWidth;
      if (windowWidth !== boxWidth) {
        windowWidth = boxWidth;
        targetX = screenWidth - windowWidth;
        win.resizeTo(windowWidth, windowHeight);
        win.moveTo(targetX, targetY);
      }
      requestAnimationFrame(adjustWindow); // requestAnimationFrame 是一个浏览器提供的 API，它会在下一个重绘之前执行回调函数。也就是说，它会使得函数 adjustWindow 在每一帧渲染的时候被调用。这对于动画和其他需要高频率更新的场景非常有用。
    }

    // 开始调整窗口大小
    adjustWindow();

    // -----拖拽------
    let dragging = false;
    let startX = 0, startY = 0;

    // 当鼠标离开 div 时，恢复窗口的大小和位置
    box.addEventListener('mouseleave', function(e) {
      // 只有当 div 并非被拖拽时，才改变窗口大小和位置
      if (!dragging) {
        windowWidth = initialWindowWidth;
        win.resizeTo(windowWidth, windowHeight);
        win.moveTo(targetX, targetY);
      }
    });

    box.addEventListener('mousedown', (event) => {
      dragging = true;
      startX = event.screenX - win.x;
      startY = event.screenY - win.y;
    });

    document.addEventListener('mousemove', (event) => {
      if (!dragging) return;
      let newX = event.screenX - startX;
      let newY = event.screenY - startY;
      win.moveTo(newX, newY);

      // 更新目标位置
      targetX = newX;
      targetY = newY;
    });

    document.addEventListener('mouseup', () => {
      dragging = false;
    });
  </script>
</body>
</html>
